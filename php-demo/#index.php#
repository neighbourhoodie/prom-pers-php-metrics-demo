<?php
use OpenTelemetry\API\Globals;
use Psr\Http\Message\ResponseInterface as Response;
use Psr\Http\Message\ServerRequestInterface as Request;
use Slim\Factory\AppFactory;

require __DIR__ . '/vendor/autoload.php';

$app = AppFactory::create();
$meter = Globals::meterProvider()->getMeter('typo3-demo');
$counter = $meter->createCounter("t3-dices");

$app->get('/rolldice', function (Request $request, Response $response) use ($counter) {
    $result = random_int(1,6);
    var_dump($counter->isEnabled());
    $counter->add($result);
    $response->getBody()->write(strval($result));
    return $response;
});

$app->run();
